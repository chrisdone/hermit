-- set-renderer latex
-- set-renderer unicode-console
-- unicode-terminal

-- START
consider 'rev
dump "paper/0-start-rev.tex" "clean" "latex" 56

set-pp-expr-type Omit
dump "paper/0b-start-rev.tex" "clean" "latex" 56

down
consider 'rev
up
fix-intro
dump "paper/1-fix-intro.tex" "clean" "latex" 56

down
apply-rule ww
up
dump "paper/2-after-ww.tex" "clean" "latex" 56

-- clean up
any-bu (compose beta-reduce let-subst)

dump "paper/3-ww-and-clean.tex" "clean" "latex" 56

-- all-bu (try (compose (var '.) inline))
any-bu (inline '.)
bash
dump "paper/4-after-bash.tex" "clean" "latex" 56

down
1
let-intro 'work
up
up
dump "paper/5-after-let-intro.tex" "clean" "latex" 56

down
let-float-arg
up
up
let-float-let
dump "paper/6-let-pair.tex" "clean" "latex" 56

consider 'work
down

any-bu (inline 'wrap)
any-bu (inline 'unwrap)
bash
1
number-binder 0
down
number-binder 1
up
up

dump "paper/7-wrap-unwrap-inlined.tex" "clean" "latex" 56

--1
--down
--down
any-bu case-float-arg
--up
--up
--up

--1
--number-binder 0
--down
--let-subst
--number-binder 1
--down
--let-subst
--up
--up
--up
dump "paper/8-wrap-unwrap-renamed.tex" "clean" "latex" 56

--1
--down
--down
--case-float-arg
--up
--up
--up
dump "paper/8b-case-float-arg.tex" "clean" "latex" 56
-- exit

-- to get repH and absH next to each other in the second case alternative
any-bu (apply-rule repAppend)
bash
dump "paper/9-rule-rep-append.tex" "clean" "latex" 56

-- doing this step right here turns out to be critical
-- to make the rest go smoothly
1
down
down
eta-expand 'ys
down
case-float-app
up
up
up
up
dump "paper/10-eta-expand-and-case-float.tex" "clean" "latex" 56

-- repH/absH fusion
any-bu (apply-rule repAppFusion)
any-bu (inline '.)
bash
dump "paper/11-rep-app-fusion.tex" "clean" "latex" 56

-- this is failing... todo: talk about in paper
-- any-bu (inline 'repH)
any-bu (apply-rule repH)
bash
-- setpp ghc
any-bu (apply-rule append)
bash
any-bu (apply-rule appendNil)
bash

any-bu (apply-rule inline-fix)
bash
up
up
let-float-let
any-bu (inline 'wrap)
any-bu (apply-rule absH)
bash
dump "paper/12-cleanup.tex" "clean" "latex" 56

--all-bu (try (compose (var 'absH) inline))
